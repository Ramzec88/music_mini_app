<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–µ—Å—Ç Google Sheets API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .test-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            background: #f7fafc;
        }

        .test-section h3 {
            color: #4a5568;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .log-container {
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
        }

        .log-success {
            color: #48bb78;
        }

        .log-error {
            color: #f56565;
        }

        .log-warning {
            color: #ed8936;
        }

        .log-info {
            color: #4299e1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .status-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-pending {
            background: #fef5e7;
            color: #744210;
        }

        .config-section {
            background: #fff5f5;
            border: 2px solid #feb2b2;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .config-section h3 {
            color: #c53030;
            margin-bottom: 15px;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            text-align: left;
        }

        .data-table th {
            background: #4a5568;
            color: white;
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background: #f7fafc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Google Sheets API</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</p>
        </div>

        <!-- Configuration Check -->
        <div class="config-section">
            <h3>‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h3>
            <div id="configCheck">
                <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å...</p>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="test-panel">
            <h2>üéØ –¢–µ—Å—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
            
            <div class="grid">
                <!-- Basic Tests -->
                <div class="test-section">
                    <h3>üîç –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã</h3>
                    <button class="btn btn-primary" onclick="testAPIAvailability()">
                        –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
                    </button>
                    <button class="btn btn-primary" onclick="testEnvironmentVars()">
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
                    </button>
                    <button class="btn btn-primary" onclick="testNetworkConnectivity()">
                        –¢–µ—Å—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                    </button>
                </div>

                <!-- Read Tests -->
                <div class="test-section">
                    <h3>üìñ –¢–µ—Å—Ç—ã —á—Ç–µ–Ω–∏—è</h3>
                    <button class="btn btn-success" onclick="testReadPromoCodes()">
                        –ß–∏—Ç–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã
                    </button>
                    <button class="btn btn-success" onclick="testReadOrders()">
                        –ß–∏—Ç–∞—Ç—å –∑–∞–∫–∞–∑—ã
                    </button>
                    <button class="btn btn-success" onclick="testReadUsers()">
                        –ß–∏—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    </button>
                </div>

                <!-- Write Tests -->
                <div class="test-section">
                    <h3>‚úèÔ∏è –¢–µ—Å—Ç—ã –∑–∞–ø–∏—Å–∏</h3>
                    <button class="btn btn-warning" onclick="testWriteUser()">
                        –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                    <button class="btn btn-warning" onclick="testWriteOrder()">
                        –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
                    </button>
                    <button class="btn btn-warning" onclick="testUpdateCell()">
                        –û–±–Ω–æ–≤–∏—Ç—å —è—á–µ–π–∫—É
                    </button>
                </div>

                <!-- Advanced Tests -->
                <div class="test-section">
                    <h3>üî¨ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Å—Ç—ã</h3>
                    <div class="form-group">
                        <label class="form-label">–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥:</label>
                        <input type="text" class="form-input" id="testPromoCode" value="TEST123" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è">
                    </div>
                    <button class="btn btn-primary" onclick="testPromoCodeValidation()">
                        –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
                    </button>
                    <button class="btn btn-danger" onclick="testErrorHandling()">
                        –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
                    </button>
                </div>
            </div>

            <!-- Full Integration Test -->
            <div class="test-section" style="text-align: center; margin-top: 30px;">
                <h3>üöÄ –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç</h3>
                <button class="btn btn-primary" onclick="runFullTest()" style="font-size: 1.2rem; padding: 15px 30px;">
                    –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>
            </div>
        </div>

        <!-- Results -->
        <div class="test-panel">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <div id="testResults">
                <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...</p>
            </div>
        </div>

        <!-- Logs -->
        <div class="test-panel">
            <h2>üìù –õ–æ–≥–∏</h2>
            <button class="btn btn-danger" onclick="clearLogs()" style="margin-bottom: 15px;">
                –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
            </button>
            <div id="logContainer" class="log-container">
                <div class="log-entry">üöÄ –°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
            </div>
        </div>
    </div>

    <script>
        // Test API Class
        class GoogleSheetsTestAPI {
            constructor() {
                this.baseUrl = '/api/sheets';
                this.testResults = {};
            }

            async makeRequest(action, params) {
                const startTime = Date.now();
                
                try {
                    logMessage(`üì° –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${action}`, 'info');
                    logMessage(`üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: ${JSON.stringify(params)}`, 'info');
                    
                    const response = await fetch(this.baseUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action,
                            ...params
                        })
                    });

                    const responseTime = Date.now() - startTime;
                    logMessage(`‚è±Ô∏è –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${responseTime}ms`, 'info');

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    logMessage(`‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç: ${JSON.stringify(data).substring(0, 200)}...`, 'success');
                    return data;
                } catch (error) {
                    logMessage(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
                    throw error;
                }
            }

            async testGet(sheetName, range = '') {
                return await this.makeRequest('get', { sheetName, range });
            }

            async testAppend(sheetName, values) {
                return await this.makeRequest('append', { sheetName, values });
            }

            async testUpdate(sheetName, range, value) {
                return await this.makeRequest('update', { 
                    sheetName, 
                    updateRange: range, 
                    updateValue: value 
                });
            }

            async testFind(sheetName, searchValue) {
                return await this.makeRequest('find', { sheetName, searchValue });
            }
        }

        const testAPI = new GoogleSheetsTestAPI();

        // Logging functions
        function logMessage(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`${type.toUpperCase()}: ${message}`);
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            logMessage('üìã –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        function updateTestResult(testName, status, details = '') {
            testAPI.testResults[testName] = { status, details, timestamp: new Date() };
            updateResultsSummary();
        }

        function updateResultsSummary() {
            const resultsContainer = document.getElementById('testResults');
            const results = testAPI.testResults;
            
            if (Object.keys(results).length === 0) {
                resultsContainer.innerHTML = '<p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...</p>';
                return;
            }

            let html = '<table class="data-table"><thead><tr><th>–¢–µ—Å—Ç</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ—Ç–∞–ª–∏</th><th>–í—Ä–µ–º—è</th></tr></thead><tbody>';
            
            for (const [testName, result] of Object.entries(results)) {
                const statusClass = result.status === 'success' ? 'status-success' : 
                                  result.status === 'error' ? 'status-error' : 'status-pending';
                
                const statusIcon = result.status === 'success' ? '‚úÖ' : 
                                 result.status === 'error' ? '‚ùå' : '‚è≥';
                
                html += `
                    <tr>
                        <td>${testName}</td>
                        <td><span class="status-indicator ${statusClass}">${statusIcon} ${result.status}</span></td>
                        <td>${result.details}</td>
                        <td>${result.timestamp.toLocaleTimeString()}</td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            resultsContainer.innerHTML = html;
        }

        // Configuration check
        async function checkConfiguration() {
            const configDiv = document.getElementById('configCheck');
            configDiv.innerHTML = '<p>üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...</p>';

            try {
                // Test API endpoint availability
                const response = await fetch('/api/sheets', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'test' })
                });

                if (response.status === 404) {
                    configDiv.innerHTML = `
                        <h4>‚ùå API —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h4>
                        <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –§–∞–π–ª /api/sheets.js –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω</p>
                        <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª api/sheets.js –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–µ—Ä–µ–¥–µ–ª–∞–π—Ç–µ –¥–µ–ø–ª–æ–π</p>
                    `;
                    return;
                }

                const data = await response.json();
                
                if (data.error && data.error.includes('configuration')) {
                    configDiv.innerHTML = `
                        <h4>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π</h4>
                        <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</p>
                        <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –î–æ–±–∞–≤—å—Ç–µ –≤ Vercel Environment Variables:</p>
                        <ul>
                            <li>GOOGLE_SHEETS_API_KEY</li>
                            <li>GOOGLE_SPREADSHEET_ID</li>
                        </ul>
                    `;
                    return;
                }

                configDiv.innerHTML = `
                    <h4>‚úÖ –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –ø–æ—Ä—è–¥–∫–µ</h4>
                    <p>API —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</p>
                `;

            } catch (error) {
                configDiv.innerHTML = `
                    <h4>‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞</h4>
                    <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                    <p><strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</strong></p>
                    <ul>
                        <li>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ</li>
                        <li>–ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º</li>
                        <li>–°–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ Vercel</li>
                    </ul>
                `;
            }
        }

        // Individual test functions
        async function testAPIAvailability() {
            const testName = 'API Availability';
            updateTestResult(testName, 'pending', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
            
            try {
                logMessage('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API...', 'info');
                
                const response = await fetch('/api/sheets', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'test' })
                });

                if (response.ok || response.status === 400) {
                    updateTestResult(testName, 'success', 'API —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞');
                    logMessage('‚úÖ API —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
            }
        }

        async function testEnvironmentVars() {
            const testName = 'Environment Variables';
            updateTestResult(testName, 'pending', '–ü—Ä–æ–≤–µ—Ä–∫–∞...');
            
            try {
                logMessage('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è...', 'info');
                
                const data = await testAPI.makeRequest('get', { sheetName: 'PromoCodes', range: 'A1:A1' });
                updateTestResult(testName, 'success', '–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                logMessage('‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ø–æ—Ä—è–¥–∫–µ', 'success');
            } catch (error) {
                if (error.message.includes('configuration')) {
                    updateTestResult(testName, 'error', '–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
                    logMessage('‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ Vercel', 'error');
                } else if (error.message.includes('403')) {
                    updateTestResult(testName, 'error', '–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Google Sheets API');
                    logMessage('‚ùå API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞', 'error');
                } else if (error.message.includes('404')) {
                    updateTestResult(testName, 'error', '–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    logMessage('‚ùå Google —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ SPREADSHEET_ID', 'error');
                } else {
                    updateTestResult(testName, 'error', error.message);
                    logMessage(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`, 'error');
                }
            }
        }

        async function testNetworkConnectivity() {
            const testName = 'Network Connectivity';
            updateTestResult(testName, 'pending', '–ü—Ä–æ–≤–µ—Ä–∫–∞...');
            
            try {
                logMessage('üåê –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'info');
                
                const startTime = Date.now();
                await fetch('https://www.google.com/favicon.ico', { mode: 'no-cors' });
                const responseTime = Date.now() - startTime;
                
                updateTestResult(testName, 'success', `–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ (${responseTime}ms)`);
                logMessage(`‚úÖ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ${responseTime}ms`, 'success');
            } catch (error) {
                updateTestResult(testName, 'error', '–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                logMessage('‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º', 'error');
            }
        }

        async function testReadPromoCodes() {
            const testName = 'Read PromoCodes';
            updateTestResult(testName, 'pending', '–ß—Ç–µ–Ω–∏–µ...');
            
            try {
                logMessage('üìñ –ß–∏—Ç–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥—ã...', 'info');
                
                const data = await testAPI.testGet('PromoCodes');
                const rowCount = data.values ? data.values.length : 0;
                
                updateTestResult(testName, 'success', `–ü—Ä–æ—á–∏—Ç–∞–Ω–æ ${rowCount} —Å—Ç—Ä–æ–∫`);
                logMessage(`‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥—ã –ø—Ä–æ—á–∏—Ç–∞–Ω—ã: ${rowCount} —Å—Ç—Ä–æ–∫`, 'success');
                
                if (data.values && data.values.length > 0) {
                    logMessage(`üìä –ü–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏: ${JSON.stringify(data.values.slice(0, 3))}`, 'info');
                }
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤: ${error.message}`, 'error');
            }
        }

        async function testReadOrders() {
            const testName = 'Read Orders';
            updateTestResult(testName, 'pending', '–ß—Ç–µ–Ω–∏–µ...');
            
            try {
                logMessage('üìñ –ß–∏—Ç–∞–µ–º –∑–∞–∫–∞–∑—ã...', 'info');
                
                const data = await testAPI.testGet('Orders');
                const rowCount = data.values ? data.values.length : 0;
                
                updateTestResult(testName, 'success', `–ü—Ä–æ—á–∏—Ç–∞–Ω–æ ${rowCount} —Å—Ç—Ä–æ–∫`);
                logMessage(`‚úÖ –ó–∞–∫–∞–∑—ã –ø—Ä–æ—á–∏—Ç–∞–Ω—ã: ${rowCount} —Å—Ç—Ä–æ–∫`, 'success');
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤: ${error.message}`, 'error');
            }
        }

        async function testReadUsers() {
            const testName = 'Read Users';
            updateTestResult(testName, 'pending', '–ß—Ç–µ–Ω–∏–µ...');
            
            try {
                logMessage('üìñ –ß–∏—Ç–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...', 'info');
                
                const data = await testAPI.testGet('Users');
                const rowCount = data.values ? data.values.length : 0;
                
                updateTestResult(testName, 'success', `–ü—Ä–æ—á–∏—Ç–∞–Ω–æ ${rowCount} —Å—Ç—Ä–æ–∫`);
                logMessage(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã: ${rowCount} —Å—Ç—Ä–æ–∫`, 'success');
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}`, 'error');
            }
        }

        async function testWriteUser() {
            const testName = 'Write Test User';
            updateTestResult(testName, 'pending', '–ó–∞–ø–∏—Å—å...');
            
            try {
                logMessage('‚úèÔ∏è –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');
                
                const testUserData = [
                    `test_${Date.now()}@example.com`,
                    '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    new Date().toISOString(),
                    new Date().toISOString(),
                    'test'
                ];
                
                const result = await testAPI.testAppend('Users', testUserData);
                
                updateTestResult(testName, 'success', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω');
                logMessage(`‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`, 'error');
            }
        }

        async function testWriteOrder() {
            const testName = 'Write Test Order';
            updateTestResult(testName, 'pending', '–ó–∞–ø–∏—Å—å...');
            
            try {
                logMessage('‚úèÔ∏è –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑...', 'info');
                
                const testOrderData = [
                    `TEST${Date.now()}`,
                    '1',
                    'test@example.com',
                    '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    'TEST123',
                    '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å',
                    '–¢–µ—Å—Ç–æ–≤—ã–π –∂–∞–Ω—Ä',
                    '–¢–µ—Å—Ç–æ–≤–∞—è —Ç–µ–º–∞ –ø–µ—Å–Ω–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API',
                    '–û—Å–æ–±—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è',
                    'pending',
                    new Date().toISOString(),
                    '',
                    '',
                    ''
                ];
                
                const result = await testAPI.testAppend('Orders', testOrderData);
                
                updateTestResult(testName, 'success', '–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω');
                logMessage(`‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: ${error.message}`, 'error');
            }
        }

        async function testUpdateCell() {
            const testName = 'Update Cell';
            updateTestResult(testName, 'pending', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...');
            
            try {
                logMessage('‚úèÔ∏è –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —è—á–µ–π–∫—É...', 'info');
                
                // –ü–æ–ø—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —è—á–µ–π–∫—É –≤ –ª–∏—Å—Ç–µ Users
                const testValue = `–¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ${new Date().toLocaleTimeString()}`;
                const result = await testAPI.testUpdate('Users', 'E1', testValue);
                
                updateTestResult(testName, 'success', '–Ø—á–µ–π–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
                logMessage(`‚úÖ –Ø—á–µ–π–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${testValue}`, 'success');
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —è—á–µ–π–∫–∏: ${error.message}`, 'error');
            }
        }

        async function testPromoCodeValidation() {
            const testName = 'Promo Code Validation';
            updateTestResult(testName, 'pending', '–í–∞–ª–∏–¥–∞—Ü–∏—è...');
            
            try {
                const promoCode = document.getElementById('testPromoCode').value;
                logMessage(`üéüÔ∏è –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–º–æ–∫–æ–¥: ${promoCode}`, 'info');
                
                const result = await testAPI.testFind('PromoCodes', promoCode);
                
                if (result.found) {
                    updateTestResult(testName, 'success', `–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞–π–¥–µ–Ω –≤ —Å—Ç—Ä–æ–∫–µ ${result.rowIndex}`);
                    logMessage(`‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞–π–¥–µ–Ω: —Å—Ç—Ä–æ–∫–∞ ${result.rowIndex}, –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(result.rowData)}`, 'success');
                } else {
                    updateTestResult(testName, 'success', '–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞)');
                    logMessage(`‚ÑπÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ`, 'info');
                }
            } catch (error) {
                updateTestResult(testName, 'error', error.message);
                logMessage(`‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞: ${error.message}`, 'error');
            }
        }

        async function testErrorHandling() {
            const testName = 'Error Handling';
            updateTestResult(testName, 'pending', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
            
            try {
                logMessage('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫...', 'info');
                
                // –ù–∞–º–µ—Ä–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å
                await testAPI.makeRequest('invalid_action', { test: true });
                
                updateTestResult(testName, 'error', '–û—à–∏–±–∫–∞ –Ω–µ –±—ã–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                logMessage('‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'error');
            } catch (error) {
                updateTestResult(testName, 'success', '–û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                logMessage(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`,
